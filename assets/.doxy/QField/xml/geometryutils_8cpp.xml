<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.9.8" xml:lang="en-US">
  <compounddef id="geometryutils_8cpp" kind="file" language="C++">
    <compoundname>geometryutils.cpp</compoundname>
    <includes refid="geometryutils_8h" local="yes">geometryutils.h</includes>
    <includes refid="rubberbandmodel_8h" local="yes">rubberbandmodel.h</includes>
    <includes local="no">qgscoordinatetransform.h</includes>
    <includes local="no">qgslinestring.h</includes>
    <includes local="no">qgspolygon.h</includes>
    <includes local="no">qgsproject.h</includes>
    <includes local="no">qgsvectorlayer.h</includes>
    <includes local="no">qgsvectorlayerutils.h</includes>
    <incdepgraph>
      <node id="10">
        <label>rubberbandmodel.h</label>
        <link refid="rubberbandmodel_8h_source"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
      </node>
      <node id="1">
        <label>src/core/utils/geometryutils.cpp</label>
        <link refid="geometryutils_8cpp"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
      </node>
      <node id="2">
        <label>geometryutils.h</label>
        <link refid="geometryutils_8h_source"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
      </node>
      <node id="11">
        <label>QDateTime</label>
      </node>
      <node id="4">
        <label>QObject</label>
      </node>
      <node id="12">
        <label>QPointF</label>
      </node>
      <node id="13">
        <label>QPointer</label>
      </node>
      <node id="14">
        <label>QVector</label>
      </node>
      <node id="5">
        <label>QtPositioning/QGeoCoordinate</label>
      </node>
      <node id="3">
        <label>qfield_core_export.h</label>
      </node>
      <node id="6">
        <label>qgis.h</label>
      </node>
      <node id="15">
        <label>qgsabstractgeometry.h</label>
      </node>
      <node id="7">
        <label>qgscoordinatereferencesystem.h</label>
      </node>
      <node id="17">
        <label>qgscoordinatetransform.h</label>
      </node>
      <node id="8">
        <label>qgsfeature.h</label>
      </node>
      <node id="9">
        <label>qgsgeometry.h</label>
      </node>
      <node id="18">
        <label>qgslinestring.h</label>
      </node>
      <node id="16">
        <label>qgspoint.h</label>
      </node>
      <node id="19">
        <label>qgspolygon.h</label>
      </node>
      <node id="20">
        <label>qgsproject.h</label>
      </node>
      <node id="21">
        <label>qgsvectorlayer.h</label>
      </node>
      <node id="22">
        <label>qgsvectorlayerutils.h</label>
      </node>
    </incdepgraph>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">/***************************************************************************</highlight></codeline>
<codeline lineno="2"><highlight class="comment"><sp/><sp/>geometryutils.cpp<sp/>-<sp/>GeometryUtils</highlight></codeline>
<codeline lineno="3"><highlight class="comment"></highlight></codeline>
<codeline lineno="4"><highlight class="comment"><sp/>---------------------</highlight></codeline>
<codeline lineno="5"><highlight class="comment"><sp/>begin<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:<sp/>05.03.2020</highlight></codeline>
<codeline lineno="6"><highlight class="comment"><sp/>copyright<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:<sp/>(C)<sp/>2020<sp/>by<sp/>Denis<sp/>Rouzaud</highlight></codeline>
<codeline lineno="7"><highlight class="comment"><sp/>email<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:<sp/>denis@opengis.ch</highlight></codeline>
<codeline lineno="8"><highlight class="comment"><sp/>***************************************************************************</highlight></codeline>
<codeline lineno="9"><highlight class="comment"><sp/>*<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="10"><highlight class="comment"><sp/>*<sp/><sp/><sp/>This<sp/>program<sp/>is<sp/>free<sp/>software;<sp/>you<sp/>can<sp/>redistribute<sp/>it<sp/>and/or<sp/>modify<sp/><sp/>*</highlight></codeline>
<codeline lineno="11"><highlight class="comment"><sp/>*<sp/><sp/><sp/>it<sp/>under<sp/>the<sp/>terms<sp/>of<sp/>the<sp/>GNU<sp/>General<sp/>Public<sp/>License<sp/>as<sp/>published<sp/>by<sp/><sp/>*</highlight></codeline>
<codeline lineno="12"><highlight class="comment"><sp/>*<sp/><sp/><sp/>the<sp/>Free<sp/>Software<sp/>Foundation;<sp/>either<sp/>version<sp/>2<sp/>of<sp/>the<sp/>License,<sp/>or<sp/><sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="13"><highlight class="comment"><sp/>*<sp/><sp/><sp/>(at<sp/>your<sp/>option)<sp/>any<sp/>later<sp/>version.<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="14"><highlight class="comment"><sp/>*<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="15"><highlight class="comment"><sp/>***************************************************************************/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;geometryutils.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;rubberbandmodel.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;qgscoordinatetransform.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;qgslinestring.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;qgspolygon.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;qgsproject.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;qgsvectorlayer.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;qgsvectorlayerutils.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight></codeline>
<codeline lineno="27"><highlight class="normal">GeometryUtils::GeometryUtils(<sp/>QObject<sp/>*parent<sp/>)</highlight></codeline>
<codeline lineno="28"><highlight class="normal"><sp/><sp/>:<sp/>QObject(<sp/>parent<sp/>)</highlight></codeline>
<codeline lineno="29"><highlight class="normal">{</highlight></codeline>
<codeline lineno="30"><highlight class="normal">}</highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight></codeline>
<codeline lineno="32"><highlight class="normal">QgsGeometry<sp/><ref refid="classGeometryUtils_1ade375b26bee18ed5a5c70f589984fecb" kindref="member">GeometryUtils::polygonFromRubberband</ref>(<sp/><ref refid="classRubberbandModel" kindref="compound">RubberbandModel</ref><sp/>*rubberBandModel,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>QgsCoordinateReferenceSystem<sp/>&amp;crs,<sp/>Qgis::WkbType<sp/>wkbType<sp/>)</highlight></codeline>
<codeline lineno="33"><highlight class="normal">{</highlight></codeline>
<codeline lineno="34"><highlight class="normal"><sp/><sp/>QgsPointSequence<sp/>ring<sp/>=<sp/>rubberBandModel-&gt;<ref refid="classRubberbandModel_1a9560b4f526080c35eaacaec81e39b17f" kindref="member">pointSequence</ref>(<sp/>crs,<sp/>Qgis::WkbType::Point,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal"><sp/>);</highlight></codeline>
<codeline lineno="35"><highlight class="normal"><sp/><sp/>QgsLineString<sp/>ext(<sp/>ring<sp/>);</highlight></codeline>
<codeline lineno="36"><highlight class="normal"><sp/><sp/>std::unique_ptr&lt;QgsPolygon&gt;<sp/>polygon<sp/>=<sp/>std::make_unique&lt;QgsPolygon&gt;();</highlight></codeline>
<codeline lineno="37"><highlight class="normal"><sp/><sp/>polygon-&gt;setExteriorRing(<sp/>ext.clone()<sp/>);</highlight></codeline>
<codeline lineno="38"><highlight class="normal"></highlight></codeline>
<codeline lineno="39"><highlight class="normal"><sp/><sp/>QgsGeometry<sp/>g(<sp/>std::move(<sp/>polygon<sp/>)<sp/>);</highlight></codeline>
<codeline lineno="40"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>QgsWkbTypes::isMultiType(<sp/>wkbType<sp/>)<sp/>)</highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/><sp/><sp/>g.convertToMultiType();</highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="44"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>g;</highlight></codeline>
<codeline lineno="45"><highlight class="normal">}</highlight></codeline>
<codeline lineno="46"><highlight class="normal"></highlight></codeline>
<codeline lineno="47"><highlight class="normal">QgsGeometry<sp/><ref refid="classGeometryUtils_1aea2ffbf6f69cd4bee87faab3facaede3" kindref="member">GeometryUtils::lineFromRubberband</ref>(<sp/><ref refid="classRubberbandModel" kindref="compound">RubberbandModel</ref><sp/>*rubberBandModel,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>QgsCoordinateReferenceSystem<sp/>&amp;crs,<sp/>Qgis::WkbType<sp/>wkbType<sp/>)</highlight></codeline>
<codeline lineno="48"><highlight class="normal">{</highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/>QgsPointSequence<sp/>points<sp/>=<sp/>rubberBandModel-&gt;<ref refid="classRubberbandModel_1a9560b4f526080c35eaacaec81e39b17f" kindref="member">pointSequence</ref>(<sp/>crs,<sp/>Qgis::WkbType::Point,<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal"><sp/>);</highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/>std::unique_ptr&lt;QgsLineString&gt;<sp/>line<sp/>=<sp/>std::make_unique&lt;QgsLineString&gt;(<sp/>points<sp/>);</highlight></codeline>
<codeline lineno="51"><highlight class="normal"></highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/>QgsGeometry<sp/>g(<sp/>std::move(<sp/>line<sp/>)<sp/>);</highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>QgsWkbTypes::isMultiType(<sp/>wkbType<sp/>)<sp/>)</highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/><sp/><sp/>g.convertToMultiType();</highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>g;</highlight></codeline>
<codeline lineno="58"><highlight class="normal">}</highlight></codeline>
<codeline lineno="59"><highlight class="normal"></highlight></codeline>
<codeline lineno="60"><highlight class="normal">QgsGeometry<sp/><ref refid="classGeometryUtils_1a742eefc791f5a0c122baf6405a9682f1" kindref="member">GeometryUtils::variableWidthBufferByMFromRubberband</ref>(<sp/><ref refid="classRubberbandModel" kindref="compound">RubberbandModel</ref><sp/>*rubberBandModel,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>QgsCoordinateReferenceSystem<sp/>&amp;crs<sp/>)</highlight></codeline>
<codeline lineno="61"><highlight class="normal">{</highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/>QgsPointSequence<sp/>points<sp/>=<sp/>rubberBandModel-&gt;<ref refid="classRubberbandModel_1a9560b4f526080c35eaacaec81e39b17f" kindref="member">pointSequence</ref>(<sp/>crs,<sp/>Qgis::WkbType::PointM,<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal"><sp/>);</highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/>std::unique_ptr&lt;QgsLineString&gt;<sp/>line<sp/>=<sp/>std::make_unique&lt;QgsLineString&gt;(<sp/>points<sp/>);</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/>QgsGeometry<sp/>g(<sp/>std::move(<sp/>line<sp/>)<sp/>);</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>g.variableWidthBufferByM(<sp/>5<sp/>);</highlight></codeline>
<codeline lineno="66"><highlight class="normal">}</highlight></codeline>
<codeline lineno="67"><highlight class="normal"></highlight></codeline>
<codeline lineno="68"><highlight class="normal"><ref refid="classGeometryUtils_1a4fbda5f2f27bb6d5cff2b3b65397a4db" kindref="member">GeometryUtils::GeometryOperationResult</ref><sp/><ref refid="classGeometryUtils_1a024640d2ade1b9d9af01cecf315d67ee" kindref="member">GeometryUtils::reshapeFromRubberband</ref>(<sp/>QgsVectorLayer<sp/>*layer,<sp/>QgsFeatureId<sp/>fid,<sp/><ref refid="classRubberbandModel" kindref="compound">RubberbandModel</ref><sp/>*rubberBandModel<sp/>)</highlight></codeline>
<codeline lineno="69"><highlight class="normal">{</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/>QgsFeature<sp/>selectedFeature<sp/>=<sp/>layer-&gt;getFeature(<sp/>fid<sp/>);</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/>QgsGeometry<sp/>selectedGeometry<sp/>=<sp/>selectedFeature.geometry();</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>selectedGeometry.isNull()<sp/>||<sp/>(<sp/>QgsWkbTypes::geometryType(<sp/>selectedGeometry.wkbType()<sp/>)<sp/>!=<sp/>Qgis::GeometryType::Line<sp/>&amp;&amp;<sp/>QgsWkbTypes::geometryType(<sp/>selectedGeometry.wkbType()<sp/>)<sp/>!=<sp/>Qgis::GeometryType::Polygon<sp/>)<sp/>)</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classGeometryUtils_1a4fbda5f2f27bb6d5cff2b3b65397a4dbadfab31971f0b606a43c7711109935d67" kindref="member">GeometryUtils::GeometryOperationResult::InvalidBaseGeometry</ref>;</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="76"><highlight class="normal"></highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>QgsPointSequence<sp/>points<sp/>=<sp/>rubberBandModel-&gt;<ref refid="classRubberbandModel_1a9560b4f526080c35eaacaec81e39b17f" kindref="member">pointSequence</ref>(<sp/>layer-&gt;crs(),<sp/>Qgis::WkbType::Point,<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal"><sp/>);</highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>QgsLineString<sp/>reshapeLineString(<sp/>points<sp/>);</highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>QgsGeometry<sp/>reshapeLineStringGeom(<sp/>reshapeLineString.clone()<sp/>);</highlight></codeline>
<codeline lineno="80"><highlight class="normal"></highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><ref refid="classGeometryUtils_1a4fbda5f2f27bb6d5cff2b3b65397a4db" kindref="member">GeometryUtils::GeometryOperationResult</ref><sp/>reshapeReturn<sp/>=<sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal"><ref refid="classGeometryUtils_1a4fbda5f2f27bb6d5cff2b3b65397a4db" kindref="member">GeometryUtils::GeometryOperationResult</ref></highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(<sp/>selectedGeometry.reshapeGeometry(<sp/>reshapeLineString<sp/>)<sp/>);</highlight></codeline>
<codeline lineno="82"><highlight class="normal"></highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Implementation<sp/>logic:</highlight></codeline>
<codeline lineno="84"><highlight class="comment"><sp/><sp/><sp/>*<sp/>-<sp/>When<sp/>both<sp/>avoid<sp/>intersection<sp/>and<sp/>topological<sp/>editing<sp/>is<sp/>off,<sp/>no<sp/>other<sp/>feature<sp/>geometries<sp/>are<sp/>changed</highlight></codeline>
<codeline lineno="85"><highlight class="comment"><sp/><sp/><sp/>*<sp/>-<sp/>When<sp/>avoid<sp/>intersection<sp/>is<sp/>on<sp/>and<sp/>topological<sp/>editing<sp/>is<sp/>off,<sp/>the<sp/>targeted<sp/>feature<sp/>will<sp/>avoid</highlight></codeline>
<codeline lineno="86"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/>overlapping<sp/>other<sp/>feature<sp/>geometries</highlight></codeline>
<codeline lineno="87"><highlight class="comment"><sp/><sp/><sp/>*<sp/>-<sp/>When<sp/>avoid<sp/>intersection<sp/>is<sp/>off<sp/>and<sp/>topological<sp/>editing<sp/>is<sp/>on,<sp/>other<sp/>features<sp/>on<sp/>the<sp/>target<sp/>layer</highlight></codeline>
<codeline lineno="88"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/>will<sp/>be<sp/>reshaped<sp/>when<sp/>overlapping<sp/>the<sp/>reshape<sp/>line</highlight></codeline>
<codeline lineno="89"><highlight class="comment"><sp/><sp/><sp/>*<sp/>-<sp/>When<sp/>both<sp/>avoid<sp/>intersection<sp/>and<sp/>topological<sp/>editing<sp/>are<sp/>on,<sp/>the<sp/>targeted<sp/>feature<sp/>will<sp/>avoid<sp/>overlapping</highlight></codeline>
<codeline lineno="90"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/>other<sp/>features<sp/>geometries<sp/>except<sp/>those<sp/>from<sp/>the<sp/>target<sp/>layer<sp/>which<sp/>will<sp/>be<sp/>reshaped<sp/>when<sp/>overlapping</highlight></codeline>
<codeline lineno="91"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/>the<sp/>reshape<sp/>line</highlight></codeline>
<codeline lineno="92"><highlight class="comment"><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>reshapeReturn<sp/>==<sp/><ref refid="classGeometryUtils_1a4fbda5f2f27bb6d5cff2b3b65397a4dba505a83f220c02df2f85c3810cd9ceb38" kindref="member">GeometryUtils::GeometryOperationResult::Success</ref><sp/>)</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//avoid<sp/>intersections<sp/>on<sp/>polygon<sp/>layers</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>layer-&gt;geometryType()<sp/>==<sp/>Qgis::GeometryType::Polygon<sp/>)</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>QList&lt;QgsVectorLayer<sp/>*&gt;<sp/>avoidIntersectionsLayers;</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(<sp/>QgsProject::instance()-&gt;avoidIntersectionsMode()<sp/>)</highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>Qgis::AvoidIntersectionsMode::AvoidIntersectionsCurrentLayer:</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>avoidIntersectionsLayers.append(<sp/>layer<sp/>);</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>Qgis::AvoidIntersectionsMode::AvoidIntersectionsLayers:</highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>avoidIntersectionsLayers<sp/>=<sp/>QgsProject::instance()-&gt;avoidIntersectionsLayers();</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>Qgis::AvoidIntersectionsMode::AllowIntersections:</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="110"><highlight class="normal"></highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>QgsProject::instance()-&gt;topologicalEditing()<sp/>)</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Since<sp/>we&apos;re<sp/>allowing<sp/>reshaping<sp/>in<sp/>our<sp/>logic<sp/>when<sp/>topological<sp/>editing<sp/>is<sp/>on,<sp/>remove<sp/>the<sp/>layer<sp/>as<sp/>it&apos;ll<sp/>never<sp/>overlap</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>avoidIntersectionsLayers.removeAll(<sp/>layer<sp/>);</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="116"><highlight class="normal"></highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>!avoidIntersectionsLayers.isEmpty()<sp/>)</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>QHash&lt;QgsVectorLayer<sp/>*,<sp/>QSet&lt;QgsFeatureId&gt;&gt;<sp/>ignoredFeature;</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ignoredFeature.insert(<sp/>layer,<sp/>QSet&lt;QgsFeatureId&gt;()<sp/>&lt;&lt;<sp/>fid<sp/>);</highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>selectedGeometry.avoidIntersectionsV2(<sp/>avoidIntersectionsLayers,<sp/>ignoredFeature<sp/>);</highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="123"><highlight class="normal"></highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>selectedGeometry.isEmpty()<sp/>)<sp/></highlight><highlight class="comment">//<sp/>Intersection<sp/>removal<sp/>might<sp/>have<sp/>removed<sp/>the<sp/>whole<sp/>geometry</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classGeometryUtils_1a4fbda5f2f27bb6d5cff2b3b65397a4dbad9b9351155ad4e06e43730e654728ed0" kindref="member">GeometryUtils::GeometryOperationResult::NothingHappened</ref>;</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="129"><highlight class="normal"></highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>QgsProject::instance()-&gt;topologicalEditing()<sp/>)</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>QgsFeatureIterator<sp/>fit<sp/>=<sp/>layer-&gt;getFeatures(<sp/>QgsFeatureRequest().setFilterRect(<sp/>selectedGeometry.boundingBox()<sp/>)<sp/>);</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>QgsFeature<sp/>otherFeature;</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(<sp/>fit.nextFeature(<sp/>otherFeature<sp/>)<sp/>)</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>otherFeature.id()<sp/>==<sp/>fid<sp/>)</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="138"><highlight class="normal"></highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>QgsGeometry<sp/>otherGeometry<sp/>=<sp/>otherFeature.geometry();</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>otherGeometry.isNull()<sp/>)</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="142"><highlight class="normal"></highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>isPolygon<sp/>=<sp/>layer-&gt;geometryType()<sp/>==<sp/>Qgis::GeometryType::Polygon;</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>selectedGeometry.intersects(<sp/>reshapeLineStringGeom<sp/>)<sp/>&amp;&amp;<sp/>otherGeometry.intersects(<sp/>reshapeLineStringGeom<sp/>)<sp/>)</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classGeometryUtils_1a4fbda5f2f27bb6d5cff2b3b65397a4db" kindref="member">GeometryUtils::GeometryOperationResult</ref><sp/>otherReturn<sp/>=<sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal"><ref refid="classGeometryUtils_1a4fbda5f2f27bb6d5cff2b3b65397a4db" kindref="member">GeometryUtils::GeometryOperationResult</ref></highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(<sp/>otherGeometry.reshapeGeometry(<sp/>reshapeLineString<sp/>)<sp/>);</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>otherReturn<sp/>==<sp/><ref refid="classGeometryUtils_1a4fbda5f2f27bb6d5cff2b3b65397a4dba505a83f220c02df2f85c3810cd9ceb38" kindref="member">GeometryUtils::GeometryOperationResult::Success</ref><sp/>)</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>!isPolygon<sp/>||<sp/>(<sp/>!otherGeometry.intersects(<sp/>selectedGeometry<sp/>)<sp/>||<sp/>otherGeometry.touches(<sp/>selectedGeometry<sp/>)<sp/>)<sp/>)</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>layer-&gt;changeGeometry(<sp/>otherFeature.id(),<sp/>otherGeometry<sp/>);</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>topological<sp/>points</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>layer-&gt;addTopologicalPoints(<sp/>otherGeometry<sp/>);</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="158"><highlight class="normal"></highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Intersect<sp/>fallback<sp/>for<sp/>polygon</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>isPolygon<sp/>)</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>!otherGeometry.intersects(<sp/>selectedGeometry<sp/>)<sp/>)</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>No<sp/>intersection,<sp/>moving<sp/>on</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="167"><highlight class="normal"></highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>otherGeometry<sp/>=<sp/>otherFeature.geometry();</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>QgsGeometry<sp/>otherGeometryDifference<sp/>=<sp/>otherGeometry.difference(<sp/>selectedGeometry<sp/>);</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>otherGeometryDifference.equals(<sp/>otherGeometry<sp/>)<sp/>)</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>No<sp/>change<sp/>to<sp/>geometry,<sp/>moving<sp/>on</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="175"><highlight class="normal"></highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>QgsWkbTypes::isMultiType(<sp/>otherGeometryDifference.wkbType()<sp/>)<sp/>&amp;&amp;<sp/>!QgsWkbTypes::isMultiType(<sp/>layer-&gt;wkbType()<sp/>)<sp/>)</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>QVector&lt;QgsGeometry&gt;<sp/>otherGeometryDifferenceCollection<sp/>=<sp/>otherGeometryDifference.asGeometryCollection();</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>QVector&lt;QgsGeometry&gt;::iterator<sp/>largestModifiedFeature<sp/>=<sp/>std::max_element(<sp/>otherGeometryDifferenceCollection.begin(),<sp/>otherGeometryDifferenceCollection.end(),<sp/>[](<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>QgsGeometry<sp/>&amp;a,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>QgsGeometry<sp/>&amp;b<sp/>)<sp/>-&gt;<sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>a.area()<sp/>&lt;<sp/>b.area();</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/>);</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>otherGeometryDifference<sp/>=<sp/>*largestModifiedFeature;</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>otherGeometryDifferenceCollection.erase(<sp/>largestModifiedFeature<sp/>);</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<sp/>QgsGeometry<sp/>&amp;otherGeometryDifferenceFromCollection<sp/>:<sp/>otherGeometryDifferenceCollection<sp/>)</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>QgsFeature<sp/>newFeature<sp/>=<sp/>QgsVectorLayerUtils::createFeature(<sp/>layer,<sp/>otherGeometryDifferenceFromCollection,<sp/>otherFeature.attributes().toMap()<sp/>);</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>QString<sp/>sourcePrimaryKeys<sp/>=<sp/>layer-&gt;customProperty(<sp/>QStringLiteral(<sp/></highlight><highlight class="stringliteral">&quot;QFieldSync/sourceDataPrimaryKeys&quot;</highlight><highlight class="normal"><sp/>)<sp/>).toString();</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>!sourcePrimaryKeys.isEmpty()<sp/>&amp;&amp;<sp/>layer-&gt;fields().lookupField(<sp/>sourcePrimaryKeys<sp/>)<sp/>&gt;=<sp/>0<sp/>)</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>sourcePrimaryKeysIndex<sp/>=<sp/>layer-&gt;fields().lookupField(<sp/>sourcePrimaryKeys<sp/>);</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>!layer-&gt;fields().at(<sp/>sourcePrimaryKeysIndex<sp/>).defaultValueDefinition().isValid()<sp/>)</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newFeature.setAttribute(<sp/>layer-&gt;fields().lookupField(<sp/>sourcePrimaryKeys<sp/>),<sp/>QVariant()<sp/>);</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>layer-&gt;addFeature(<sp/>newFeature<sp/>);</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>topological<sp/>points</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>layer-&gt;addTopologicalPoints(<sp/>otherGeometryDifference<sp/>);</highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>layer-&gt;changeGeometry(<sp/>otherFeature.id(),<sp/>otherGeometryDifference<sp/>);</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>topological<sp/>points</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>layer-&gt;addTopologicalPoints(<sp/>otherGeometryDifference<sp/>);</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="207"><highlight class="normal"></highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/>layer-&gt;changeGeometry(<sp/>fid,<sp/>selectedGeometry<sp/>);</highlight></codeline>
<codeline lineno="209"><highlight class="normal"></highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>topological<sp/>points</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>QgsProject::instance()-&gt;topologicalEditing()<sp/>)</highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>layer-&gt;addTopologicalPoints(<sp/>selectedGeometry<sp/>);</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="216"><highlight class="normal"></highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>reshapeReturn;</highlight></codeline>
<codeline lineno="218"><highlight class="normal">}</highlight></codeline>
<codeline lineno="219"><highlight class="normal"></highlight></codeline>
<codeline lineno="220"><highlight class="normal"><ref refid="classGeometryUtils_1a4fbda5f2f27bb6d5cff2b3b65397a4db" kindref="member">GeometryUtils::GeometryOperationResult</ref><sp/><ref refid="classGeometryUtils_1a65087208ea3d8b8f6aafd1d62e915b87" kindref="member">GeometryUtils::eraseFromRubberband</ref>(<sp/>QgsVectorLayer<sp/>*layer,<sp/>QgsFeatureId<sp/>fid,<sp/><ref refid="classRubberbandModel" kindref="compound">RubberbandModel</ref><sp/>*rubberBandModel<sp/>)</highlight></codeline>
<codeline lineno="221"><highlight class="normal">{</highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/>QgsFeature<sp/>feature<sp/>=<sp/>layer-&gt;getFeature(<sp/>fid<sp/>);</highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/>QgsGeometry<sp/>geom<sp/>=<sp/>feature.geometry();</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>geom.isNull()<sp/>||<sp/>(<sp/>QgsWkbTypes::geometryType(<sp/>geom.wkbType()<sp/>)<sp/>!=<sp/>Qgis::GeometryType::Line<sp/>&amp;&amp;<sp/>QgsWkbTypes::geometryType(<sp/>geom.wkbType()<sp/>)<sp/>!=<sp/>Qgis::GeometryType::Polygon<sp/>)<sp/>)</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classGeometryUtils_1a4fbda5f2f27bb6d5cff2b3b65397a4dbadfab31971f0b606a43c7711109935d67" kindref="member">GeometryUtils::GeometryOperationResult::InvalidBaseGeometry</ref>;</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="228"><highlight class="normal"></highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>QgsGeometry<sp/>diffGeom<sp/>=<sp/><ref refid="classGeometryUtils_1a742eefc791f5a0c122baf6405a9682f1" kindref="member">variableWidthBufferByMFromRubberband</ref>(<sp/>rubberBandModel,<sp/>layer-&gt;crs()<sp/>);</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/>QgsGeometry<sp/>resultGeom<sp/>=<sp/>geom.difference(<sp/>diffGeom<sp/>);</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>!resultGeom.isNull()<sp/>)</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>QgsWkbTypes::isMultiType(<sp/>resultGeom.wkbType()<sp/>)<sp/>&amp;&amp;<sp/>!QgsWkbTypes::isMultiType(<sp/>layer-&gt;wkbType()<sp/>)<sp/>)</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classGeometryUtils_1a4fbda5f2f27bb6d5cff2b3b65397a4dba65cdf852725557fc95a752a2f5ddd891" kindref="member">GeometryUtils::GeometryOperationResult::AddPartNotMultiGeometry</ref>;</highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="237"><highlight class="normal"></highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/>layer-&gt;changeGeometry(<sp/>fid,<sp/>resultGeom<sp/>);</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>topological<sp/>points</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>QgsProject::instance()-&gt;topologicalEditing()<sp/>)</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>layer-&gt;addTopologicalPoints(<sp/>resultGeom<sp/>);</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classGeometryUtils_1a4fbda5f2f27bb6d5cff2b3b65397a4dba505a83f220c02df2f85c3810cd9ceb38" kindref="member">GeometryUtils::GeometryOperationResult::Success</ref>;</highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="246"><highlight class="normal"></highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classGeometryUtils_1a4fbda5f2f27bb6d5cff2b3b65397a4dba2888f1aee3f18ef8ec8fa5a6c60f2fd8" kindref="member">GeometryUtils::GeometryOperationResult::InvalidInputGeometryType</ref>;</highlight></codeline>
<codeline lineno="248"><highlight class="normal">}</highlight></codeline>
<codeline lineno="249"><highlight class="normal"></highlight></codeline>
<codeline lineno="250"><highlight class="normal"><ref refid="classGeometryUtils_1a4fbda5f2f27bb6d5cff2b3b65397a4db" kindref="member">GeometryUtils::GeometryOperationResult</ref><sp/><ref refid="classGeometryUtils_1a0e5e0050a7c504b8fb51fde632088686" kindref="member">GeometryUtils::addRingFromRubberband</ref>(<sp/>QgsVectorLayer<sp/>*layer,<sp/>QgsFeatureId<sp/>fid,<sp/><ref refid="classRubberbandModel" kindref="compound">RubberbandModel</ref><sp/>*rubberBandModel<sp/>)</highlight></codeline>
<codeline lineno="251"><highlight class="normal">{</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>!layer<sp/>||<sp/>!rubberBandModel<sp/>)</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classGeometryUtils_1a4fbda5f2f27bb6d5cff2b3b65397a4dbad9b9351155ad4e06e43730e654728ed0" kindref="member">GeometryUtils::GeometryOperationResult::NothingHappened</ref>;</highlight></codeline>
<codeline lineno="254"><highlight class="normal"></highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/>QgsPointSequence<sp/>ring<sp/>=<sp/>rubberBandModel-&gt;<ref refid="classRubberbandModel_1a9560b4f526080c35eaacaec81e39b17f" kindref="member">pointSequence</ref>(<sp/>layer-&gt;crs(),<sp/>layer-&gt;wkbType(),<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal"><sp/>);</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>ring.size()<sp/>&lt;<sp/>3<sp/>)</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classGeometryUtils_1a4fbda5f2f27bb6d5cff2b3b65397a4dbae6e0f913d0cae04b1e5e684307805242" kindref="member">GeometryUtils::GeometryOperationResult::AddRingNotValid</ref>;</highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="260"><highlight class="normal"></highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//Try<sp/>to<sp/>fix<sp/>invalid<sp/>geometries,<sp/>useful<sp/>when<sp/>being<sp/>passed<sp/>on<sp/>a<sp/>freehand<sp/>digitized<sp/>ring</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/>QgsGeometry<sp/>geometry(<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>QgsLineString(<sp/>ring<sp/>)<sp/>);</highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>!geometry.isNull()<sp/>)</highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/>geometry<sp/>=<sp/>geometry.makeValid();</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>!geometry.isNull()<sp/>)</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal">QgsLineString<sp/>*</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(<sp/>geometry.get()<sp/>)-&gt;points(<sp/>ring<sp/>);</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="271"><highlight class="normal"></highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>wasEditing<sp/>=<sp/>(<sp/>layer-&gt;editBuffer()<sp/>);</highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>!wasEditing<sp/>)</highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/>layer-&gt;startEditing();</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/>layer-&gt;commitChanges(<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal"><sp/>);</highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="281"><highlight class="normal"></highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><ref refid="classGeometryUtils_1a4fbda5f2f27bb6d5cff2b3b65397a4db" kindref="member">GeometryUtils::GeometryOperationResult</ref><sp/>result<sp/>=<sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal"><ref refid="classGeometryUtils_1a4fbda5f2f27bb6d5cff2b3b65397a4db" kindref="member">GeometryUtils::GeometryOperationResult</ref></highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(<sp/>layer-&gt;addRing(<sp/>ring,<sp/>&amp;fid<sp/>)<sp/>);</highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>result<sp/>!=<sp/><ref refid="classGeometryUtils_1a4fbda5f2f27bb6d5cff2b3b65397a4dba505a83f220c02df2f85c3810cd9ceb38" kindref="member">GeometryUtils::GeometryOperationResult::Success</ref><sp/>)</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/>layer-&gt;rollBack();</highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/>layer-&gt;commitChanges(<sp/>!wasEditing<sp/>);</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="291"><highlight class="normal"></highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>result;</highlight></codeline>
<codeline lineno="293"><highlight class="normal">}</highlight></codeline>
<codeline lineno="294"><highlight class="normal"></highlight></codeline>
<codeline lineno="295"><highlight class="normal"><ref refid="classGeometryUtils_1a4fbda5f2f27bb6d5cff2b3b65397a4db" kindref="member">GeometryUtils::GeometryOperationResult</ref><sp/><ref refid="classGeometryUtils_1ad9ae9a2fae85efa5ab810209163fca5a" kindref="member">GeometryUtils::splitFeatureFromRubberband</ref>(<sp/>QgsVectorLayer<sp/>*layer,<sp/>QgsFeatureId<sp/>fid,<sp/><ref refid="classRubberbandModel" kindref="compound">RubberbandModel</ref><sp/>*rubberBandModel<sp/>)</highlight></codeline>
<codeline lineno="296"><highlight class="normal">{</highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>!layer<sp/>||<sp/>!rubberBandModel<sp/>)</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classGeometryUtils_1a4fbda5f2f27bb6d5cff2b3b65397a4dbad9b9351155ad4e06e43730e654728ed0" kindref="member">GeometryUtils::GeometryOperationResult::NothingHappened</ref>;</highlight></codeline>
<codeline lineno="299"><highlight class="normal"></highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>connection<sp/>below<sp/>will<sp/>be<sp/>triggered<sp/>when<sp/>the<sp/>new<sp/>feature<sp/>is<sp/>committed<sp/>and<sp/>will<sp/>provide</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>saved<sp/>feature<sp/>ID<sp/>needed<sp/>to<sp/>fetch<sp/>the<sp/>saved<sp/>feature<sp/>back<sp/>from<sp/>the<sp/>data<sp/>provider</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/>QgsFeatureIds<sp/>createdFeatureIds;</highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/>QMetaObject::Connection<sp/>connection<sp/>=<sp/>connect(<sp/>layer,<sp/>&amp;QgsVectorLayer::featureAdded,<sp/>[&amp;createdFeatureIds](<sp/>QgsFeatureId<sp/>fid<sp/>)<sp/>{<sp/>createdFeatureIds<sp/>&lt;&lt;<sp/>fid;<sp/>}<sp/>);</highlight></codeline>
<codeline lineno="304"><highlight class="normal"></highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/>layer-&gt;selectByIds(<sp/>QgsFeatureIds()<sp/>&lt;&lt;<sp/>fid,<sp/>Qgis::SelectBehavior::SetSelection<sp/>);</highlight></codeline>
<codeline lineno="306"><highlight class="normal"></highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>wasEditing<sp/>=<sp/>(<sp/>layer-&gt;editBuffer()<sp/>);</highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>!wasEditing<sp/>)</highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/><sp/><sp/>layer-&gt;startEditing();</highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/>layer-&gt;commitChanges(<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal"><sp/>);</highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="316"><highlight class="normal"></highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/>QgsPointSequence<sp/>line<sp/>=<sp/>rubberBandModel-&gt;<ref refid="classRubberbandModel_1a9560b4f526080c35eaacaec81e39b17f" kindref="member">pointSequence</ref>(<sp/>layer-&gt;crs(),<sp/>Qgis::WkbType::Point,<sp/>false<sp/>);</highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/><ref refid="classGeometryUtils_1a4fbda5f2f27bb6d5cff2b3b65397a4db" kindref="member">GeometryUtils::GeometryOperationResult</ref><sp/>result<sp/>=<sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal"><ref refid="classGeometryUtils_1a4fbda5f2f27bb6d5cff2b3b65397a4db" kindref="member">GeometryUtils::GeometryOperationResult</ref></highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(<sp/>layer-&gt;splitFeatures(<sp/>line,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal"><sp/>)<sp/>);</highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>result<sp/>!=<sp/><ref refid="classGeometryUtils_1a4fbda5f2f27bb6d5cff2b3b65397a4dba505a83f220c02df2f85c3810cd9ceb38" kindref="member">GeometryUtils::GeometryOperationResult::Success</ref><sp/>)</highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/><sp/><sp/>layer-&gt;rollBack();</highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>QString<sp/>sourcePrimaryKeys<sp/>=<sp/>layer-&gt;customProperty(<sp/>QStringLiteral(<sp/></highlight><highlight class="stringliteral">&quot;QFieldSync/sourceDataPrimaryKeys&quot;</highlight><highlight class="normal"><sp/>)<sp/>).toString();</highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>!sourcePrimaryKeys.isEmpty()<sp/>&amp;&amp;<sp/>layer-&gt;fields().lookupField(<sp/>sourcePrimaryKeys<sp/>)<sp/>&gt;=<sp/>0<sp/>)</highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>sourcePrimaryKeysIndex<sp/>=<sp/>layer-&gt;fields().lookupField(<sp/>sourcePrimaryKeys<sp/>);</highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>!layer-&gt;fields().at(<sp/>sourcePrimaryKeysIndex<sp/>).defaultValueDefinition().isValid()<sp/>)</highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>QgsFeatureId<sp/>&amp;createdFeatureId<sp/>:<sp/>createdFeatureIds<sp/>)</highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>layer-&gt;changeAttributeValue(<sp/>createdFeatureId,<sp/>sourcePrimaryKeysIndex,<sp/>QVariant()<sp/>);</highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/><sp/><sp/>layer-&gt;commitChanges(<sp/>!wasEditing<sp/>);</highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="339"><highlight class="normal"></highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/>layer-&gt;removeSelection();</highlight></codeline>
<codeline lineno="341"><highlight class="normal"></highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/>disconnect(<sp/>connection<sp/>);</highlight></codeline>
<codeline lineno="343"><highlight class="normal"></highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>result;</highlight></codeline>
<codeline lineno="345"><highlight class="normal">}</highlight></codeline>
<codeline lineno="346"><highlight class="normal"></highlight></codeline>
<codeline lineno="347"><highlight class="normal">QgsPoint<sp/><ref refid="classGeometryUtils_1a089a2936b0483fbab512bc4712146961" kindref="member">GeometryUtils::coordinateToPoint</ref>(<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>QGeoCoordinate<sp/>&amp;coor<sp/>)</highlight></codeline>
<codeline lineno="348"><highlight class="normal">{</highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>QgsPoint(<sp/>coor.longitude(),<sp/>coor.latitude(),<sp/>coor.altitude()<sp/>);</highlight></codeline>
<codeline lineno="350"><highlight class="normal">}</highlight></codeline>
<codeline lineno="351"><highlight class="normal"></highlight></codeline>
<codeline lineno="352"><highlight class="normal"></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/><ref refid="classGeometryUtils_1aa657468a5ea06e7246938c49ac150368" kindref="member">GeometryUtils::distanceBetweenPoints</ref>(<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>QgsPoint<sp/>&amp;start,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>QgsPoint<sp/>&amp;end<sp/>)</highlight></codeline>
<codeline lineno="353"><highlight class="normal">{</highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>start.distance(<sp/>end<sp/>);</highlight></codeline>
<codeline lineno="355"><highlight class="normal">}</highlight></codeline>
<codeline lineno="356"><highlight class="normal"></highlight></codeline>
<codeline lineno="357"><highlight class="normal">QgsPoint<sp/><ref refid="classGeometryUtils_1a44d2aeb62f1e679ad77b6eca0a2b2018" kindref="member">GeometryUtils::reprojectPointToWgs84</ref>(<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>QgsPoint<sp/>&amp;<ref refid="classpoint" kindref="compound">point</ref>,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>QgsCoordinateReferenceSystem<sp/>&amp;crs<sp/>)</highlight></codeline>
<codeline lineno="358"><highlight class="normal">{</highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>QgsCoordinateReferenceSystem<sp/>wgs84Crs<sp/>=<sp/>QgsCoordinateReferenceSystem(<sp/>QStringLiteral(<sp/></highlight><highlight class="stringliteral">&quot;EPSG:4326&quot;</highlight><highlight class="normal"><sp/>)<sp/>);</highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>QgsCoordinateTransform<sp/>ct(<sp/>crs,<sp/>wgs84Crs,<sp/>QgsProject::instance()<sp/>);</highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/>QgsPointXY<sp/>reprojectedPoint;</highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/><sp/><sp/>ct.transform(<sp/><ref refid="classpoint" kindref="compound">point</ref>.x(),<sp/><ref refid="classpoint" kindref="compound">point</ref>.y()<sp/>);</highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/><sp/><sp/>reprojectedPoint<sp/>=<sp/>ct.transform(<sp/><ref refid="classpoint" kindref="compound">point</ref><sp/>);</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(<sp/>QgsCsException<sp/>&amp;<sp/>)</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>QgsPoint();</highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="371"><highlight class="normal"></highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>QgsPoint(<sp/>reprojectedPoint.x(),</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>reprojectedPoint.y(),</highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classpoint" kindref="compound">point</ref>.is3D()<sp/>?<sp/><ref refid="classpoint" kindref="compound">point</ref>.z()<sp/>:<sp/>std::numeric_limits&lt;double&gt;::quiet_NaN(),</highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classpoint" kindref="compound">point</ref>.isMeasure()<sp/>?<sp/><ref refid="classpoint" kindref="compound">point</ref>.m()<sp/>:<sp/>std::numeric_limits&lt;double&gt;::quiet_NaN()<sp/>);</highlight></codeline>
<codeline lineno="376"><highlight class="normal">}</highlight></codeline>
<codeline lineno="377"><highlight class="normal"></highlight></codeline>
<codeline lineno="378"><highlight class="normal">QgsPoint<sp/><ref refid="classGeometryUtils_1a8b10654e6679ce9a13a39640843a176b" kindref="member">GeometryUtils::centroid</ref>(<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>QgsGeometry<sp/>&amp;geometry<sp/>)</highlight></codeline>
<codeline lineno="379"><highlight class="normal">{</highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>QgsGeometry<sp/><ref refid="classGeometryUtils_1a8b10654e6679ce9a13a39640843a176b" kindref="member">centroid</ref><sp/>=<sp/>geometry.centroid();</highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>!<ref refid="classGeometryUtils_1a8b10654e6679ce9a13a39640843a176b" kindref="member">centroid</ref>.isEmpty()<sp/>)</highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>QgsPoint(<sp/>*</highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="keyword">const<sp/></highlight><highlight class="normal">QgsPoint<sp/>*</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(<sp/><ref refid="classGeometryUtils_1a8b10654e6679ce9a13a39640843a176b" kindref="member">centroid</ref>.constGet()<sp/>)<sp/>);</highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>QgsPoint();</highlight></codeline>
<codeline lineno="386"><highlight class="normal">}</highlight></codeline>
<codeline lineno="387"><highlight class="normal"></highlight></codeline>
<codeline lineno="388"><highlight class="normal">QgsPoint<sp/><ref refid="classGeometryUtils_1afd274863b81cfb12a760335791c3c533" kindref="member">GeometryUtils::reprojectPoint</ref>(<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>QgsPoint<sp/>&amp;<ref refid="classpoint" kindref="compound">point</ref>,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>QgsCoordinateReferenceSystem<sp/>&amp;sourceCrs,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>QgsCoordinateReferenceSystem<sp/>&amp;destinationCrs<sp/>)</highlight></codeline>
<codeline lineno="389"><highlight class="normal">{</highlight></codeline>
<codeline lineno="390"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>sourceCrs<sp/>==<sp/>destinationCrs<sp/>)</highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classpoint" kindref="compound">point</ref>;</highlight></codeline>
<codeline lineno="392"><highlight class="normal"></highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>QgsCoordinateTransform<sp/>ct(<sp/>sourceCrs,<sp/>destinationCrs,<sp/>QgsProject::instance()<sp/>);</highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/>QgsPointXY<sp/>reprojectedPoint;</highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/><sp/><sp/>ct.transform(<sp/><ref refid="classpoint" kindref="compound">point</ref>.x(),<sp/><ref refid="classpoint" kindref="compound">point</ref>.y()<sp/>);</highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/>reprojectedPoint<sp/>=<sp/>ct.transform(<sp/><ref refid="classpoint" kindref="compound">point</ref><sp/>);</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(<sp/>QgsCsException<sp/>&amp;<sp/>)</highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>QgsPoint();</highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="404"><highlight class="normal"></highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>QgsPoint(<sp/>reprojectedPoint.x(),</highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>reprojectedPoint.y(),</highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classpoint" kindref="compound">point</ref>.is3D()<sp/>?<sp/><ref refid="classpoint" kindref="compound">point</ref>.z()<sp/>:<sp/>std::numeric_limits&lt;double&gt;::quiet_NaN(),</highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classpoint" kindref="compound">point</ref>.isMeasure()<sp/>?<sp/><ref refid="classpoint" kindref="compound">point</ref>.m()<sp/>:<sp/>std::numeric_limits&lt;double&gt;::quiet_NaN()<sp/>);</highlight></codeline>
<codeline lineno="409"><highlight class="normal">}</highlight></codeline>
<codeline lineno="410"><highlight class="normal"></highlight></codeline>
<codeline lineno="411"><highlight class="normal">QgsRectangle<sp/><ref refid="classGeometryUtils_1aafe494a5f05e50e535d40142fc00ccaf" kindref="member">GeometryUtils::reprojectRectangle</ref>(<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>QgsRectangle<sp/>&amp;rectangle,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>QgsCoordinateReferenceSystem<sp/>&amp;sourceCrs,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>QgsCoordinateReferenceSystem<sp/>&amp;destinationCrs<sp/>)</highlight></codeline>
<codeline lineno="412"><highlight class="normal">{</highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>sourceCrs<sp/>==<sp/>destinationCrs<sp/>)</highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>rectangle;</highlight></codeline>
<codeline lineno="415"><highlight class="normal"></highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>QgsCoordinateTransform<sp/>ct(<sp/>sourceCrs,<sp/>destinationCrs,<sp/>QgsProject::instance()<sp/>);</highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/>QgsRectangle<sp/>reprojectedRectangle;</highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/>reprojectedRectangle<sp/>=<sp/>ct.transform(<sp/>rectangle<sp/>);</highlight></codeline>
<codeline lineno="421"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(<sp/>QgsCsException<sp/>&amp;<sp/>)</highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>QgsRectangle();</highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="426"><highlight class="normal"></highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>reprojectedRectangle;</highlight></codeline>
<codeline lineno="428"><highlight class="normal">}</highlight></codeline>
<codeline lineno="429"><highlight class="normal"></highlight></codeline>
<codeline lineno="430"><highlight class="normal">QgsGeometry<sp/><ref refid="classGeometryUtils_1ad4cbe79d674007e0ca2b5aa93f7b7324" kindref="member">GeometryUtils::createGeometryFromWkt</ref>(<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>QString<sp/>&amp;wkt<sp/>)</highlight></codeline>
<codeline lineno="431"><highlight class="normal">{</highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>QgsGeometry::fromWkt(<sp/>wkt<sp/>);</highlight></codeline>
<codeline lineno="433"><highlight class="normal">}</highlight></codeline>
<codeline lineno="434"><highlight class="normal"></highlight></codeline>
<codeline lineno="435"><highlight class="normal">QgsRectangle<sp/><ref refid="classGeometryUtils_1a6f8183233e363c348b7dbba4fe923008" kindref="member">GeometryUtils::createRectangleFromPoints</ref>(<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>QgsPoint<sp/>&amp;p1,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>QgsPoint<sp/>&amp;p2<sp/>)</highlight></codeline>
<codeline lineno="436"><highlight class="normal">{</highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>QgsRectangle(<sp/>p1,<sp/>p2<sp/>);</highlight></codeline>
<codeline lineno="438"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="src/core/utils/geometryutils.cpp"/>
  </compounddef>
</doxygen>
